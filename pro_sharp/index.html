<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>線上預約（DEMO）— 直角專業風</title>

<style>
/* ====== 基礎 ====== */
:root{
  --ink:#0f172a;        /* 深墨 */
  --sub:#334155;        /* 次要文字 */
  --line:#e5e7eb;       /* 邊線 */
  --bg:#f8fafc;         /* 背景 */
  --brand:#3b82f6;      /* 主色：深藍 */
  --brand-600:#2563eb;
  --muted:#64748b;

  --slot-am:#10b981;    /* 早診 pill */
  --slot-pm:#f59e0b;    /* 午診 pill */
  --slot-nite:#3b82f6;  /* 晚診 pill */

  --today:#475569;      /* 今天底色（深灰） */
  --today-ink:#fff;     /* 今天日期字色 */
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;background:#fff;color:var(--ink);font-family:system-ui,-apple-system,"Noto Sans TC","Microsoft JhengHei",Segoe UI,Roboto,Arial,sans-serif}

/* ====== 容器 / 標頭 ====== */
.wrap{max-width:1100px;margin:28px auto;padding:0 16px}
h1{margin:0 0 10px;font-size:clamp(28px,3.6vw,40px);letter-spacing:.04em}
.subtle{color:var(--muted)}
.toolbar{display:flex;align-items:center;gap:10px;flex-wrap:wrap;margin:10px 0 18px}
.btn{border:1px solid var(--line);background:#fff;color:var(--ink);padding:.55rem .9rem;border-radius:8px;cursor:pointer;font-weight:700}
.btn:active{transform:translateY(1px)}
.btn-primary{background:var(--brand);border-color:var(--brand);color:#fff}
.btn-primary:hover{background:var(--brand-600)}

/* ====== 月曆 ====== */
.calendar{border:1px solid var(--line);border-radius:10px;background:#fff;overflow:hidden}
.cal-head{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border-bottom:1px solid var(--line);background:#f9fafb}
.cal-title{font-weight:900}
.nav{display:flex;gap:6px}
.nav .btn{padding:.45rem .7rem;border-radius:6px}

.grid{display:grid;grid-template-columns:repeat(7,1fr);border-top:1px solid var(--line)}
.cell{min-height:108px;border-right:1px solid var(--line);border-bottom:1px solid var(--line);padding:10px 10px 8px;display:flex;flex-direction:column}
.grid > .cell:nth-child(7n){border-right:none}
.whead{background:#f9fafb;font-weight:900;text-align:center;padding:10px;border-right:1px solid var(--line);border-bottom:1px solid var(--line)}
.whead:last-child{border-right:none}

.dnum{font-weight:900}
.meta{margin-top:auto;font-size:.92rem;color:var(--muted)}
.cell.other-month{background:#fafafa;color:#94a3b8}
.cell.disabled{color:#94a3b8;background:#f8fafc}
.cell.clickable{cursor:pointer}
.cell.clickable:hover{background:#f1f5f9}
.cell.selected{outline:2px solid var(--brand);outline-offset:-2px}

/* 今天：灰底反白日期；底下維持「—」 */
.cell.today{background:var(--today);color:#cbd5e1}
.cell.today .dnum{color:var(--today-ink)}

/* 小 pill（格子內） */
.pill{display:inline-block;font-weight:900;font-size:.82rem;border:1px solid currentColor;border-radius:6px;padding:.15rem .4rem;margin-right:6px}
.pill.am{color:var(--slot-am)}
.pill.pm{color:var(--slot-pm)}
.pill.nite{color:var(--slot-nite)}

/* ====== 當日可預約 ====== */
.panel{border:1px solid var(--line);border-radius:10px;padding:14px;margin-top:18px;background:#fff}
.panel h3{margin:0 0 10px;font-size:20px}
.slot-list{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
@media (max-width:680px){ .slot-list{grid-template-columns:1fr} }

.slot-card{border:1px solid var(--line);border-radius:10px;padding:10px 12px;display:flex;align-items:center;gap:10px}
.slot-card .badge{font-weight:900;border-radius:6px;padding:.2rem .4rem;border:1px solid transparent}
.badge.am{color:#065f46;background:#ecfdf5;border-color:#a7f3d0}
.badge.pm{color:#7c2d12;background:#fffbeb;border-color:#fde68a}
.badge.nite{color:#1e3a8a;background:#eff6ff;border-color:#bfdbfe}
.slot-main{font-weight:900}
.slot-sub{margin-left:auto;color:var(--sub)}

/* ====== 表單 ====== */
.form{border:1px solid var(--line);border-radius:10px;padding:14px;background:#fff;margin-top:12px}
.row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
@media (max-width:680px){ .row{grid-template-columns:1fr} }
.field label{display:block;font-weight:900;margin:2px 0 6px}
.input{width:100%;border:1px solid var(--line);border-radius:8px;height:44px;padding:0 .8rem}
.check{display:flex;align-items:center;gap:8px;margin-top:6px}
.submit{margin-top:12px}
.full{width:100%}

/* 小提示列 */
.note{display:flex;align-items:center;gap:8px;color:var(--sub);font-size:.95rem}
.note .dot{width:8px;height:8px;border-radius:2px;background:#cbd5e1}
</style>
</head>
<body>
<div class="wrap">
  <h1>線上預約（DEMO）</h1>

  <div class="toolbar">
    <div class="note"><span class="dot"></span><span id="now">現在時間：</span></div>
    <button class="btn" id="ruleBtn">開放預約日期規則</button>
  </div>

  <!-- 月曆 -->
  <div class="calendar" id="calendar">
    <div class="cal-head">
      <div class="cal-title" id="calTitle"></div>
      <div class="nav">
        <button class="btn" id="prevM">◀︎ 上一月</button>
        <button class="btn" id="nextM">下一月 ▶︎</button>
      </div>
    </div>
    <div class="grid" id="whead"></div>
    <div class="grid" id="days"></div>
  </div>

  <!-- 當日可預約 -->
  <div class="panel" id="dailyPanel" style="display:none">
    <h3 id="dayTitle">—</h3>
    <div class="slot-list" id="slotList"></div>
  </div>

  <!-- 表單 -->
  <form class="form" id="form" style="display:none" onsubmit="return false;">
    <div class="row">
      <div class="field">
        <label>姓名 *</label>
        <input class="input" id="name" autocomplete="off" />
      </div>
      <div class="field">
        <label>出生年月日 *</label>
        <input type="date" class="input" id="birthday" />
      </div>
      <div class="field">
        <label>身分證字號 *</label>
        <input class="input" id="idnum" maxlength="10" placeholder="A123456789" />
      </div>
      <div class="field">
        <label>聯絡電話 *</label>
        <input class="input" id="phone" maxlength="10" placeholder="0958xxxxxx" />
      </div>
    </div>

    <div class="check">
      <input type="checkbox" id="agree">
      <label for="agree">我已閱讀並同意預約須知</label>
    </div>

    <div class="submit">
      <button class="btn btn-primary full" id="submitBtn">送出預約</button>
    </div>
  </form>
</div>

<script>
/* ================= 工具 ================= */
const pad2 = n => String(n).padStart(2,'0');
const toYMD = d => `${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}`;
const W = ['日','一','二','三','四','五','六'];
const $ = id => document.getElementById(id);

function formatNow(){
  const d = new Date();
  $('now').textContent = `現在時間：${d.getFullYear()}/${pad2(d.getMonth()+1)}/${pad2(d.getDate())}（週${W[d.getDay()]}）`;
}

/* ============ 假資料（示範）============
   你之後把這裡換成你的 Google Apps Script 回傳資料即可。
   這裡是「某些日期、各診別剩餘人數與時間、醫師、診間」。 */
function fakeSlotsFor(ymd){
  // 隨機生成
  const seed = ymd.split('-').join('')|0;
  const rand = (a,b)=>{ const x=(Math.sin(seed+a*13+b*7)+1)/2; return x; };

  const arr = [];
  if(rand(1,1)>.35) arr.push({kind:'早診',slot:'am', time:'08:30~11:30', doctor:'陳萬龍', room:'101', remain: Math.round(rand(1,2)*10) });
  if(rand(2,2)>.45) arr.push({kind:'午診',slot:'pm', time:'14:00~17:00', doctor:'王小明', room:'203', remain: Math.round(rand(2,3)*10) });
  if(rand(3,3)>.55) arr.push({kind:'晚診',slot:'nite',time:'18:00~20:30', doctor:'林美好', room:'305', remain: Math.round(rand(3,4)*10) });
  return arr;
}

/* ================= 月曆（完整 6x7） ================= */
const today = new Date();
let view = new Date(today.getFullYear(), today.getMonth(), 1);

function buildWeekHead(){
  $('whead').innerHTML = W.map(w => `<div class="whead">週${w}</div>`).join('');
}
buildWeekHead();

function renderCalendar(){
  $('calTitle').textContent = `${view.getFullYear()} 年 ${view.getMonth()+1} 月`;
  // 取本月第一天與最後一天
  const first = new Date(view.getFullYear(), view.getMonth(), 1);
  const last  = new Date(view.getFullYear(), view.getMonth()+1, 0);

  // 讓格子固定 6x7：從「第一天所在週的週日」開始，到後面共 42 天
  const start = new Date(first);
  start.setDate(first.getDate() - first.getDay());   // 回到該週的週日
  const total = 42;

  let html = '';
  for(let i=0;i<total;i++){
    const cur = new Date(start); cur.setDate(start.getDate()+i);
    const key = toYMD(cur);
    const other = (cur.getMonth()!==view.getMonth());
    const isToday = (key===toYMD(today));

    // 取得此日的開放診別（示範：任何日都有可能）
    const slots = fakeSlotsFor(key);
    const hasOpen = slots.length>0;

    let cls = 'cell';
    if(other) cls+=' other-month';
    if(hasOpen) cls+=' clickable';
    if(isToday) cls+=' today';

    // 畫面：日期、底部「—」或 pill
    let pills = hasOpen
      ? slots.map(s=>`<span class="pill ${s.slot}">${s.kind}</span>`).join('')
      : '—';

    html+=`
      <div class="${cls}" data-ymd="${key}">
        <div class="dnum">${cur.getDate()}</div>
        <div class="meta">${pills}</div>
      </div>`;
  }
  $('days').innerHTML = html;

  // 綁定點擊：開下方卡片 + 顯示表單
  document.querySelectorAll('#days .cell.clickable').forEach(el=>{
    el.addEventListener('click',()=>{
      document.querySelectorAll('#days .cell.selected').forEach(x=>x.classList.remove('selected'));
      el.classList.add('selected');
      openDay(el.dataset.ymd);
    });
  });
}

function openDay(ymd){
  const slots = fakeSlotsFor(ymd);
  $('dailyPanel').style.display = 'block';
  $('form').style.display = 'block';
  const d = new Date(ymd+'T08:00:00');
  $('dayTitle').textContent = `${ymd}（星期${W[d.getDay()]}）／當日可預約`;

  $('slotList').innerHTML = slots.map(s=>`
    <div class="slot-card">
      <span class="badge ${s.slot}">${s.kind}</span>
      <div class="slot-main">${s.time}</div>
      <div class="slot-sub">醫師：${s.doctor}｜診間：${s.room}｜剩餘 ${s.remain} 人</div>
    </div>
  `).join('') || `<div class="subtle">此日目前沒有開放預約</div>`;
}

/* 事件：切換月份 */
$('prevM').onclick = ()=>{ view = new Date(view.getFullYear(), view.getMonth()-1, 1); renderCalendar(); };
$('nextM').onclick = ()=>{ view = new Date(view.getFullYear(), view.getMonth()+1, 1); renderCalendar(); };

/* 表單小功能 */
$('idnum').addEventListener('input', e=>{
  const p = e.target.selectionStart;
  e.target.value = e.target.value.toUpperCase();
  try{ e.target.setSelectionRange(p,p); }catch(_){}
});
$('submitBtn').onclick = ()=>{
  const name = $('name').value.trim();
  const bday = $('birthday').value.trim();
  const id   = $('idnum').value.trim();
  const phone= $('phone').value.trim();
  if(!name || !bday || !id || !phone || !$('agree').checked){
    alert('請把資料填完整並同意須知'); return;
  }
  alert('示範：表單驗證通過。實務上在這裡呼叫你的後端 API 送出預約。');
};

/* 啟動 */
formatNow();
renderCalendar();
</script>
</body>
</html>

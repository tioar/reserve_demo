<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>線上預約（DEMO A：逐步精靈版）</title>
<style>
:root{
  --brand:#5a37c6; --brand-600:#4a2fb0;
  --ink:#1a142b; --muted:#6f6a86;
  --bg:#f7f6fb; --card:#fff; --line:#ebe6fb;
  --ok:#16a34a; --warn:#ca8a04;
  --green:#0d7a54; --blue:#1c52dd; --amber:#8a5a00; --pink:#9b197b;
}
*{box-sizing:border-box}
html,body{margin:0;background:var(--bg);color:var(--ink);
  font-family:"Noto Sans TC","Microsoft JhengHei",system-ui,sans-serif}
.wrap{max-width:1080px;margin:10px auto;padding:0 14px}
.h1{display:flex;align-items:center;gap:10px;font-weight:900;font-size:clamp(22px,4.6vw,30px);margin:6px 0 10px}
.logo{width:40px;height:40px;border-radius:10px;background:var(--brand);color:#fff;display:grid;place-items:center;font-weight:900}

/* 步驟條 */
.steps{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:10px}
.step{border-radius:999px;padding:.5rem 1rem;font-weight:900;border:1px solid #dcd5ff;background:#fff;color:#4b2ea9}
.step.current{background:var(--brand);color:#fff;border-color:transparent}
.step.done{background:#e9edff;color:#2c3aa6;border-color:#cfd7fe}

/* 版心：左側內容 + 右側摘要 */
.board{display:grid;grid-template-columns:1.2fr .8fr;gap:14px}
@media (max-width:900px){ .board{grid-template-columns:1fr} }

/* 共用卡片 */
.card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:12px}
.tt{font-weight:900;margin:4px 2px 8px}

/* chips / list */
.row{display:flex;gap:8px;flex-wrap:wrap}
.chip{border:1px solid #d9def0;border-radius:999px;background:#fff;padding:.44rem .92rem;font-weight:800;cursor:pointer}
.chip[aria-pressed="true"]{background:#e9edff;border-color:#cfd7fe;color:#2236a3}

/* 月曆 */
.grid7{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}
.wd{color:var(--muted);text-align:center;font-weight:800}
.day{min-height:76px;background:#fff;border:1px solid #e7e4fb;border-radius:12px;display:flex;flex-direction:column;gap:6px;padding:8px}
.day .d{font-weight:900}
.day.clickable{cursor:pointer}
.day.clickable:hover{box-shadow:0 0 0 2px #e3defc}
.day.selected{box-shadow:0 0 0 2px #d8ccff}
.day.today{background:#3a4150;color:#fff;border-color:#3a4150}
.day.today .d{color:#fff}

/* pills */
.pill{display:inline-block;border:1px solid #e6e7f4;border-radius:999px;padding:.08rem .46rem;font-weight:900;font-size:.75rem}
.pill.early{background:#e7f7ee;color:var(--green);border-color:#cdeee0}
.pill.noon {background:#fff3df;color:var(--amber);border-color:#ffe0a6}
.pill.night{background:#e8f2ff;color:var(--blue); border-color:#cfe2ff}
.pill.appt {background:#fde7ef;color:var(--pink); border-color:#ffc6e9}

/* 時段 list */
.tile{border:1px solid #e1e4f6;border-radius:12px;padding:10px;background:#fff;display:flex;gap:10px;align-items:center}
.tile:hover{box-shadow:0 0 0 2px #ece8ff}
.tile .remain{margin-left:auto;color:#475569}
.tile.selected{box-shadow:0 0 0 2px #d8ccff}

/* 右側摘要、表單 */
.summary .kv{display:flex;gap:8px;margin:4px 0;color:#374151}
.summary .k{min-width:4em;color:#6b7280}
.input{border:1px solid #dedbf6;border-radius:12px;height:46px;padding:0 .9rem;background:#fff;width:100%}
.form{display:grid;gap:10px;margin-top:8px}

.btn{border:none;border-radius:12px;padding:.92rem 1rem;font-weight:900;cursor:pointer}
.btn-main{background:var(--brand);color:#fff}
.btn-main[disabled]{opacity:.5;cursor:not-allowed}
.btn-main:hover{background:var(--brand-600)}
.btn-ghost{background:#fff;border:1px solid #d8dbe7;color:#374151}

/* 底部導航 */
.navbar{position:sticky;bottom:0;margin-top:10px}
.navbar .bar{display:flex;gap:10px;justify-content:flex-end; background:rgba(255,255,255,.6);backdrop-filter:blur(4px);
  border:1px solid var(--line);border-radius:14px;padding:10px}
.navbar .bar .left{margin-right:auto}
</style>
</head>
<body>
<div class="wrap">
  <div class="h1"><div class="logo">＋</div> 線上預約（DEMO A：逐步精靈）</div>

  <!-- 步驟條 -->
  <div class="steps" id="stepsBar"></div>

  <div class="board">
    <!-- 左側：步驟內容 -->
    <div id="stage"></div>

    <!-- 右側：摘要與表單（表單只在第4步顯示） -->
    <div class="card summary" id="side">
      <div class="tt">預約資訊</div>
      <div class="kv"><div class="k">科別</div><div id="sDept">—</div></div>
      <div class="kv"><div class="k">醫師</div><div id="sDoc">—</div></div>
      <div class="kv"><div class="k">日期</div><div id="sDate">—</div></div>
      <div class="kv"><div class="k">時段</div><div id="sSlot">—</div></div>

      <div id="formWrap" style="display:none">
        <div class="tt" style="margin-top:10px">填寫資料</div>
        <div class="form">
          <input id="name" class="input" placeholder="姓名 *"/>
          <input id="birthday" class="input" type="date" placeholder="出生年月日 *"/>
          <input id="idnum" class="input" maxlength="10" placeholder="身分證字號 *"/>
          <input id="phone" class="input" maxlength="10" inputmode="numeric" placeholder="聯絡電話 *"/>
          <label><input type="checkbox" id="agree"> 我已閱讀並同意預約須知</label>
          <button class="btn btn-main" id="submit">送出預約</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 底部導覽 -->
  <div class="navbar">
    <div class="bar">
      <div class="left" id="hint">步驟 1：選擇科別/醫師</div>
      <button class="btn btn-ghost" id="prevBtn" disabled>上一步</button>
      <button class="btn btn-main" id="nextBtn" disabled>下一步</button>
    </div>
  </div>
</div>

<script>
/* ---------------- 假資料（可替換 API） ---------------- */
const DEPTS=[{id:'ped',name:'小兒科'},{id:'fm',name:'家醫科'},{id:'der',name:'皮膚科'}];
const DOCTORS=[{id:'cheng',name:'陳萬龍 醫師',dept:'fm'},
               {id:'tsai',name:'蔡怡君 醫師',dept:'ped'},
               {id:'lin',name:'林子杰 醫師',dept:'der'}];
const SLOT_TYPES={early:'早診',noon:'午診',night:'晚診'};
function pad2(n){return String(n).padStart(2,'0')}
function ymd(d){return `${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}`}
const W=['日','一','二','三','四','五','六'];

/* 依醫師+日期回傳假時段 */
function getSlots(date,docId){
  const r=()=>Math.random();
  const arr=[];
  if(r()<.7) arr.push({slot:'early',time:'08:30~11:30',remain:5+Math.floor(r()*6)});
  if(r()<.6) arr.push({slot:'noon', time:'14:00~17:00',remain:5+Math.floor(r()*6)});
  if(r()<.5) arr.push({slot:'night',time:'18:00~20:30',remain:5+Math.floor(r()*6)});
  return arr;
}
/* ----------------------------------------------------- */

/* 狀態 */
const state={
  step:1,
  dept:null, doc:null,
  date:null, slot:null
};

const $=s=>document.querySelector(s);
const stage=$('#stage');
const stepsBar=$('#stepsBar');
const btnPrev=$('#prevBtn');
const btnNext=$('#nextBtn');
const hint=$('#hint');

/* 顯示摘要 */
function refreshSummary(){
  $('#sDept').textContent = DEPTS.find(d=>d.id===state.dept)?.name || '—';
  $('#sDoc').textContent  = DOCTORS.find(d=>d.id===state.doc)?.name || '—';
  $('#sDate').textContent = state.date ? `${state.date}（週${W[new Date(state.date+'T09:00:00').getDay()]}）` : '—';
  $('#sSlot').textContent = state.slot ? `${SLOT_TYPES[state.slot.type]} ${state.slot.time}` : '—';
}

/* 步驟條 */
function renderSteps(){
  const names=['選擇科別/醫師','選擇日期','選擇時段','填寫資料'];
  stepsBar.innerHTML = names.map((n,i)=>{
    const idx=i+1;
    const cls = idx<state.step ? 'step done' : (idx===state.step ? 'step current':'step');
    return `<div class="${cls}">${idx} ${n}</div>`;
  }).join('');
}

/* 每步畫面 */
function render(){
  renderSteps(); refreshSummary();
  btnPrev.disabled = state.step===1;
  $('#formWrap').style.display = (state.step===4?'block':'none');

  // 控制 Next 按鈕可否按
  let nextEnable=false;
  if(state.step===1) nextEnable=!!(state.dept && state.doc);
  if(state.step===2) nextEnable=!!state.date;
  if(state.step===3) nextEnable=!!state.slot;
  btnNext.disabled=!nextEnable;
  hint.textContent = `步驟 ${state.step}：${['選擇科別/醫師','選擇日期','選擇時段','填寫資料'][state.step-1]}`;

  // 依步驟渲染內容
  if(state.step===1) renderStep1();
  if(state.step===2) renderStep2();
  if(state.step===3) renderStep3();
  if(state.step===4) renderStep4();
}

/* Step 1：科別/醫師 */
function renderStep1(){
  stage.innerHTML=`
    <div class="card">
      <div class="tt">選擇科別</div>
      <div class="row" id="deptRow"></div>
      <div class="tt" style="margin-top:10px">選擇醫師</div>
      <div class="row" id="docRow"></div>
    </div>`;
  const deptRow=$('#deptRow'), docRow=$('#docRow');

  DEPTS.forEach(d=>{
    const b=document.createElement('button');
    b.className='chip'; b.textContent=d.name; b.type='button';
    if(state.dept===d.id) b.setAttribute('aria-pressed','true');
    b.onclick=()=>{ state.dept = (state.dept===d.id?null:d.id); if(state.dept!==d.id) state.doc=null; render(); };
    deptRow.appendChild(b);
  });

  DOCTORS.filter(x=>!state.dept || x.dept===state.dept).forEach(doc=>{
    const b=document.createElement('button');
    b.className='chip'; b.textContent=doc.name; b.type='button';
    if(state.doc===doc.id) b.setAttribute('aria-pressed','true');
    b.onclick=()=>{ state.doc = (state.doc===doc.id?null:doc.id); render(); };
    docRow.appendChild(b);
  });
}

/* Step 2：日期（月曆） */
function renderStep2(){
  const now=new Date();
  const first=new Date(now.getFullYear(),now.getMonth(),1);
  const last =new Date(now.getFullYear(),now.getMonth()+1,0);
  stage.innerHTML=`
    <div class="card">
      <div class="tt">${now.getFullYear()} 年 ${now.getMonth()+1} 月</div>
      <div class="grid7">${W.map(w=>`<div class="wd">${w}</div>`).join('')}</div>
      <div class="grid7" id="days"></div>
    </div>`;
  const pad=first.getDay();
  const days=$('#days'); let html='';
  for(let i=0;i<pad;i++) html+=`<div></div>`;
  for(let d=1; d<=last.getDate(); d++){
    const key=ymd(new Date(now.getFullYear(),now.getMonth(),d));
    const isToday = (key===ymd(new Date()));
    html+=`<div class="day clickable ${isToday?'today':''} ${state.date===key?'selected':''}" data-ymd="${key}">
      <div class="d">${d}</div>
      <div class="meta">—</div>
    </div>`;
  }
  days.innerHTML=html;
  days.querySelectorAll('.day.clickable').forEach(el=>{
    el.onclick=()=>{ state.date=el.dataset.ymd; render(); };
  });
}

/* Step 3：時段（依醫師+日期） */
function renderStep3(){
  if(!state.doc || !state.date){ stage.innerHTML='<div class="card">請先完成前一步。</div>'; return; }
  const slots=getSlots(state.date, state.doc);
  stage.innerHTML=`<div class="card">
    <div class="tt">${state.date}（週${W[new Date(state.date+'T09:00:00').getDay()]}）</div>
    <div id="slotList" style="display:grid;gap:10px"></div>
  </div>`;
  const list=$('#slotList');
  if(!slots.length){ list.innerHTML='<div style="color:#8a8fa6">本日無開放時段</div>'; return; }
  slots.forEach(s=>{
    const row=document.createElement('div');
    row.className='tile'; row.innerHTML=`
      <span class="pill ${s.slot}">${SLOT_TYPES[s.slot]}</span>
      <div>${s.time}</div>
      <div class="remain">剩 ${s.remain} 人</div>`;
    row.onclick=()=>{ 
      state.slot={type:s.slot,time:s.time}; 
      list.querySelectorAll('.tile').forEach(x=>x.classList.remove('selected'));
      row.classList.add('selected'); 
      render();
    };
    if(state.slot && state.slot.type===s.slot && state.slot.time===s.time) row.classList.add('selected');
    list.appendChild(row);
  });
}

/* Step 4：表單（右側顯示，左側放說明） */
function renderStep4(){
  stage.innerHTML=`<div class="card"><div class="tt">步驟 4：確認並填寫資料</div>
  <div style="color:#6b7280">請於右側填寫姓名、生日等資訊後送出。</div></div>`;
}

/* 下一步 / 上一步 */
btnNext.onclick=()=>{
  if(state.step===4) return;
  state.step++;
  render();
};
btnPrev.onclick=()=>{
  if(state.step===1) return;
  state.step--;
  render();
};

/* 送出（Demo） */
$('#submit').onclick=()=>{
  const ok=$('#name').value.trim() && $('#birthday').value && $('#idnum').value.trim() && $('#phone').value.trim() && $('#agree').checked;
  if(!ok){ alert('資料未填完整'); return; }
  alert(`Demo 送出成功：\n${DEPTS.find(d=>d.id===state.dept)?.name}｜${DOCTORS.find(d=>d.id===state.doc)?.name}\n${state.date}｜${SLOT_TYPES[state.slot.type]} ${state.slot.time}`);
};

/* 初始化 */
render();
</script>
</body>
</html>
